<!DOCTYPE html>
<html>
<head>
    <title>0G Analytics API - Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .header { text-align: center; margin-bottom: 30px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 300px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .key-list { margin-top: 20px; }
        .key-item { padding: 15px; margin: 10px 0; background: #f9f9f9; border-radius: 5px; border-left: 4px solid #007cba; }
        .usage-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat { text-align: center; padding: 10px; background: #e9f4ff; border-radius: 4px; }
        .tier-free { border-left-color: #28a745; }
        .tier-pro { border-left-color: #ffc107; }
        .tier-enterprise { border-left-color: #dc3545; }
        .pricing { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .plan { padding: 20px; border: 2px solid #ddd; border-radius: 8px; text-align: center; }
        .plan.pro { border-color: #ffc107; }
        .plan.enterprise { border-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ 0G Analytics API - Admin Panel</h1>
            <p>Manage API keys and monitor usage</p>
        </div>

        <!-- Create New API Key -->
        <div class="section">
            <h2>Create New API Key</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="email" placeholder="customer@example.com" required>
            </div>
            <div class="form-group">
                <label>Tier:</label>
                <select id="tier">
                    <option value="free">Free (100 requests/day)</option>
                    <option value="pro">Pro (10,000 requests/day)</option>
                    <option value="enterprise">Enterprise (100,000 requests/day)</option>
                </select>
            </div>
            <button onclick="createKey()">Generate API Key</button>
            <div id="newKeyResult" style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 4px; display: none;">
                <strong>New API Key Created:</strong><br>
                <code id="newKeyValue" style="background: #f8f9fa; padding: 5px; border-radius: 3px;"></code>
            </div>
        </div>

        <!-- Pricing Plans -->
        <div class="section">
            <h2>Pricing Plans</h2>
            <div class="pricing">
                <div class="plan">
                    <h3>Free</h3>
                    <div style="font-size: 24px; font-weight: bold;">$0/month</div>
                    <ul style="text-align: left;">
                        <li>100 requests/day</li>
                        <li>3,000 requests/month</li>
                        <li>Basic analytics</li>
                        <li>Community support</li>
                    </ul>
                </div>
                <div class="plan pro">
                    <h3>Pro</h3>
                    <div style="font-size: 24px; font-weight: bold;">$99/month</div>
                    <ul style="text-align: left;">
                        <li>10,000 requests/day</li>
                        <li>300,000 requests/month</li>
                        <li>Full analytics suite</li>
                        <li>Priority support</li>
                        <li>USD pricing data</li>
                    </ul>
                </div>
                <div class="plan enterprise">
                    <h3>Enterprise</h3>
                    <div style="font-size: 24px; font-weight: bold;">$499/month</div>
                    <ul style="text-align: left;">
                        <li>100,000 requests/day</li>
                        <li>3,000,000 requests/month</li>
                        <li>Custom analytics</li>
                        <li>Dedicated support</li>
                        <li>SLA guarantee</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- API Keys List -->
        <div class="section">
            <h2>Active API Keys</h2>
            <button onclick="loadKeys()">Refresh Keys</button>
            <div id="keysList" class="key-list">
                <p>Click "Refresh Keys" to load API keys...</p>
            </div>
        </div>

        <!-- Usage Instructions -->
        <div class="section">
            <h2>API Usage Instructions</h2>
            <p><strong>Authentication Methods:</strong></p>
            <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
# Method 1: Header (Recommended)
curl -H "X-API-Key: your_api_key_here" https://zerog-node-rpc.onrender.com/api/price

# Method 2: Bearer Token
curl -H "Authorization: Bearer your_api_key_here" https://zerog-node-rpc.onrender.com/api/price

# Method 3: Query Parameter
curl "https://zerog-node-rpc.onrender.com/api/price?apikey=your_api_key_here"
            </pre>
            
            <p><strong>Available Endpoints:</strong></p>
            <ul>
                <li><code>/api/price</code> - Get 0G token price in USD</li>
                <li><code>/api/analytics/{token}</code> - Complete token analytics</li>
                <li><code>/api/trades/{token}?includeUSD=true</code> - Enhanced trades with USD</li>
                <li><code>/api/convert</code> - Convert 0G to USD</li>
                <li><code>/api/market/summary</code> - Multi-token market overview</li>
            </ul>
        </div>
    </div>

    <script>
        async function createKey() {
            const email = document.getElementById('email').value;
            const tier = document.getElementById('tier').value;
            
            if (!email) {
                alert('Please enter an email address');
                return;
            }
            
            try {
                const response = await fetch('/admin/create-key', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, tier })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('newKeyValue').textContent = result.apiKey;
                    document.getElementById('newKeyResult').style.display = 'block';
                    document.getElementById('email').value = '';
                    loadKeys(); // Refresh the keys list
                } else {
                    alert('Error creating key: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function loadKeys() {
            try {
                const response = await fetch('/admin/keys');
                const result = await response.json();
                
                if (result.success) {
                    displayKeys(result.keys);
                } else {
                    document.getElementById('keysList').innerHTML = '<p>Error loading keys: ' + result.error + '</p>';
                }
            } catch (error) {
                document.getElementById('keysList').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        }
        
        function displayKeys(keys) {
            if (keys.length === 0) {
                document.getElementById('keysList').innerHTML = '<p>No API keys found.</p>';
                return;
            }
            
            let html = '';
            keys.forEach(key => {
                const usage = key.usage;
                html += `
                    <div class="key-item tier-${key.tier}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${key.email}</strong> - ${key.tier.toUpperCase()} Plan
                                <br><small>Key: ${key.key} | Created: ${key.created} | Last Used: ${key.lastUsed}</small>
                            </div>
                            <div style="text-align: right;">
                                <span style="color: ${key.active ? 'green' : 'red'};">${key.active ? 'Active' : 'Inactive'}</span>
                            </div>
                        </div>
                        ${usage ? `
                        <div class="usage-stats">
                            <div class="stat">
                                <strong>Daily Usage</strong><br>
                                ${usage.daily.used} / ${usage.daily.limit}<br>
                                <small>${usage.daily.remaining} remaining</small>
                            </div>
                            <div class="stat">
                                <strong>Monthly Usage</strong><br>
                                ${usage.monthly.used} / ${usage.monthly.limit}<br>
                                <small>${usage.monthly.remaining} remaining</small>
                            </div>
                            <div class="stat">
                                <strong>Total Requests</strong><br>
                                ${usage.total}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            document.getElementById('keysList').innerHTML = html;
        }
        
        // Load keys on page load
        window.onload = function() {
            loadKeys();
        };
    </script>
</body>
</html>
